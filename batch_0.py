# -*- coding: utf-8 -*-
"""
Created on Fri May 10 15:55:30 2019

@author: adoxey3
"""

# -*- coding: utf-8 -*-
"""
Created on Fri May  3 10:40:55 2019

@author: ngrasley
"""

import sys
sys.path.append("R:/JoePriceResearch/record_linking/projects/deep_learning/ml-record-linking/Splycer")
from Splycer.Splycer         import Splycer
from FeatureEngineer import FeatureEngineer
from XGBoostMatch    import XGBoostMatch

import pickle as pkl
import pandas as pd
import pyodbc
import traceback
from time import time






def run_prediction_batch(batch_num):
    years = ["1900", "1920"]
    index1 = batch_num * 10000000
    index2 = index1 + 100000
    #Create the object that finds all of the raw data from various files
    try:
        #Create the object that handles generating features
        feature_engineer = FeatureEngineer()
        features = ["imputer", "bool match", "euclidean distance", "jaro-winkler", 
                    "ngram", "drop", "commonality weight"] #FIXME add immigration imputer to FeatureEngineer
        first_vec = [f"first_vec{i}" for i in range(2, 202)]
        #last_vec = [f"last_vec{i}" for i in range(2,202)]
        cols_to_drop = ["marstat", "birth_year", "household", "immigration", "race", "rel", "female",
                        "bp", "mbp", "fbp", "state", "county", "cohort1", 
                        "cohort2", "last_sdxn", "first_sdxn", "last_init",
                        "first_init", "bp_comm", "first_comm", "last_comm", "bp_lat", "bp_lon",
                        "res_lat", "res_lon", "full_name"]
        cols_to_drop.extend(first_vec)
        #cols_to_drop.extend(last_vec)
        feature_params = [{"cols": ["first_comm", "last_comm"], "years": years}, 
                          {"vars_to_match": ["marstat", "race", "rel", "mbp", "fbp", "first_sdxn", "last_sdxn", "bp", "county"], "years": years},
                          {"variables": [["immigration"], ["birth_year"], ["res_lat", "res_lon"], ["bp_lat", "bp_lon"], [f"first_vec{i}" for i in range(2, 202)], [f"last_vec{i}" for i in range(2,202)]], "new_cols": ["immigration_dist", "birth_year_dist", "geodist", "bp_geodist", "first_vec_dist", "last_vec_dist"], "years": years},
                          {"string_col": ["first", "last"], "dist_metric": "jw", "years": years},
                          {"string_col": ["first", "last"], "n": 2, "years": years},
                          {"cols_to_drop": ["first", "last"], "both_years": True, "years": years},
                          {"cols": ["first_jw", "last_jw", "first_sdxn_match", "last_sdxn_match", "bp_match"], "comm_cols": ["first", "last", "first", "last", "bp"], "years": years}]
    
        for i, j in zip(features, feature_params):
            feature_engineer.add_feature(i, j)
        
        #Create the object that trains the model
        trainer_predictor = XGBoostMatch()
        hyper_params = {"max_depth": [3], "learning_rate": [0.01], "n_estimators": [2500]}
        trainer_predictor.set_hyper_params(hyper_params)
        
        record_linker = Splycer(feature_engineer=feature_engineer, xgboost=trainer_predictor)
        conn = pyodbc.connect("DSN=rec_db")
        with open("R:/JoePriceResearch/record_linking/projects/deep_learning/ml-record-linking/model_post_sql3.xgboost", "rb") as file:
            model = pkl.load(file)
        percent_completed = 0
        print("Running predictions...")
        start = time()
        stop_index = index1 + 10000000
        while index1 < stop_index:
            print(f"{percent_completed}% completed")
            percent_completed += 10
            chunk_num = 1
            sql_code = f"""
SELECT census_{years[0]}.index_{years[0]}, census_{years[0]}.marstat_{years[0]}, census_{years[0]}.birth_year_{years[0]}, census_{years[0]}.household_{years[0]}, census_{years[0]}.immigration_{years[0]}, census_{years[0]}.race_{years[0]}, census_{years[0]}.rel_{years[0]},
	   census_{years[0]}.female_{years[0]}, census_{years[0]}.bp_{years[0]}, census_{years[0]}.mbp_{years[0]}, census_{years[0]}.fbp_{years[0]}, census_{years[0]}.state_{years[0]}, census_{years[0]}.county_{years[0]}, census_{years[0]}.cohort1_{years[0]},
	   census_{years[0]}.cohort2_{years[0]}, census_{years[0]}.last_sdxn_{years[0]}, census_{years[0]}.first_sdxn_{years[0]}, census_{years[0]}.last_init_{years[0]}, census_{years[0]}.first_init_{years[0]},
	   census_{years[0]}.bp_comm_{years[0]}, census_{years[0]}.first_comm_{years[0]}, census_{years[0]}.last_comm_{years[0]},
	   census_{years[0]}.first_{years[0]}, census_{years[0]}.last_{years[0]},
	   census_{years[0]}.bp_lat_{years[0]}, census_{years[0]}.bp_lon_{years[0]},
	   census_{years[0]}.res_lat_{years[0]}, census_{years[0]}.res_lon_{years[0]},
	   census_{years[0]}.full_name_{years[0]},
	   first_vec_{years[0]}.first_vec2 as first_vec2_{years[0]}, first_vec_{years[0]}.first_vec3 as first_vec3_{years[0]}, first_vec_{years[0]}.first_vec4 as first_vec4_{years[0]}, first_vec_{years[0]}.first_vec5 as first_vec5_{years[0]}, first_vec_{years[0]}.first_vec6 as first_vec6_{years[0]}, first_vec_{years[0]}.first_vec7 as first_vec7_{years[0]}, first_vec_{years[0]}.first_vec8 as first_vec8_{years[0]}, first_vec_{years[0]}.first_vec9 as first_vec9_{years[0]}, first_vec_{years[0]}.first_vec10 as first_vec10_{years[0]}, first_vec_{years[0]}.first_vec11 as first_vec11_{years[0]}, first_vec_{years[0]}.first_vec12 as first_vec12_{years[0]}, first_vec_{years[0]}.first_vec13 as first_vec13_{years[0]}, first_vec_{years[0]}.first_vec14 as first_vec14_{years[0]}, first_vec_{years[0]}.first_vec15 as first_vec15_{years[0]}, first_vec_{years[0]}.first_vec16 as first_vec16_{years[0]}, first_vec_{years[0]}.first_vec17 as first_vec17_{years[0]}, first_vec_{years[0]}.first_vec18 as first_vec18_{years[0]}, first_vec_{years[0]}.first_vec19 as first_vec19_{years[0]}, first_vec_{years[0]}.first_vec20 as first_vec20_{years[0]}, first_vec_{years[0]}.first_vec21 as first_vec21_{years[0]}, first_vec_{years[0]}.first_vec22 as first_vec22_{years[0]}, first_vec_{years[0]}.first_vec23 as first_vec23_{years[0]}, first_vec_{years[0]}.first_vec24 as first_vec24_{years[0]}, first_vec_{years[0]}.first_vec25 as first_vec25_{years[0]}, first_vec_{years[0]}.first_vec26 as first_vec26_{years[0]}, first_vec_{years[0]}.first_vec27 as first_vec27_{years[0]}, first_vec_{years[0]}.first_vec28 as first_vec28_{years[0]}, first_vec_{years[0]}.first_vec29 as first_vec29_{years[0]}, first_vec_{years[0]}.first_vec30 as first_vec30_{years[0]}, first_vec_{years[0]}.first_vec31 as first_vec31_{years[0]}, first_vec_{years[0]}.first_vec32 as first_vec32_{years[0]}, first_vec_{years[0]}.first_vec33 as first_vec33_{years[0]}, first_vec_{years[0]}.first_vec34 as first_vec34_{years[0]}, first_vec_{years[0]}.first_vec35 as first_vec35_{years[0]}, first_vec_{years[0]}.first_vec36 as first_vec36_{years[0]}, first_vec_{years[0]}.first_vec37 as first_vec37_{years[0]}, first_vec_{years[0]}.first_vec38 as first_vec38_{years[0]}, first_vec_{years[0]}.first_vec39 as first_vec39_{years[0]}, first_vec_{years[0]}.first_vec40 as first_vec40_{years[0]}, first_vec_{years[0]}.first_vec41 as first_vec41_{years[0]}, first_vec_{years[0]}.first_vec42 as first_vec42_{years[0]}, first_vec_{years[0]}.first_vec43 as first_vec43_{years[0]}, first_vec_{years[0]}.first_vec44 as first_vec44_{years[0]}, first_vec_{years[0]}.first_vec45 as first_vec45_{years[0]}, first_vec_{years[0]}.first_vec46 as first_vec46_{years[0]}, first_vec_{years[0]}.first_vec47 as first_vec47_{years[0]}, first_vec_{years[0]}.first_vec48 as first_vec48_{years[0]}, first_vec_{years[0]}.first_vec49 as first_vec49_{years[0]}, first_vec_{years[0]}.first_vec50 as first_vec50_{years[0]}, first_vec_{years[0]}.first_vec51 as first_vec51_{years[0]}, first_vec_{years[0]}.first_vec52 as first_vec52_{years[0]}, first_vec_{years[0]}.first_vec53 as first_vec53_{years[0]}, first_vec_{years[0]}.first_vec54 as first_vec54_{years[0]}, first_vec_{years[0]}.first_vec55 as first_vec55_{years[0]}, first_vec_{years[0]}.first_vec56 as first_vec56_{years[0]}, first_vec_{years[0]}.first_vec57 as first_vec57_{years[0]}, first_vec_{years[0]}.first_vec58 as first_vec58_{years[0]}, first_vec_{years[0]}.first_vec59 as first_vec59_{years[0]}, first_vec_{years[0]}.first_vec60 as first_vec60_{years[0]}, first_vec_{years[0]}.first_vec61 as first_vec61_{years[0]}, first_vec_{years[0]}.first_vec62 as first_vec62_{years[0]}, first_vec_{years[0]}.first_vec63 as first_vec63_{years[0]}, first_vec_{years[0]}.first_vec64 as first_vec64_{years[0]}, first_vec_{years[0]}.first_vec65 as first_vec65_{years[0]}, first_vec_{years[0]}.first_vec66 as first_vec66_{years[0]}, first_vec_{years[0]}.first_vec67 as first_vec67_{years[0]}, first_vec_{years[0]}.first_vec68 as first_vec68_{years[0]}, first_vec_{years[0]}.first_vec69 as first_vec69_{years[0]}, first_vec_{years[0]}.first_vec70 as first_vec70_{years[0]}, first_vec_{years[0]}.first_vec71 as first_vec71_{years[0]}, first_vec_{years[0]}.first_vec72 as first_vec72_{years[0]}, first_vec_{years[0]}.first_vec73 as first_vec73_{years[0]}, first_vec_{years[0]}.first_vec74 as first_vec74_{years[0]}, first_vec_{years[0]}.first_vec75 as first_vec75_{years[0]}, first_vec_{years[0]}.first_vec76 as first_vec76_{years[0]}, first_vec_{years[0]}.first_vec77 as first_vec77_{years[0]}, first_vec_{years[0]}.first_vec78 as first_vec78_{years[0]}, first_vec_{years[0]}.first_vec79 as first_vec79_{years[0]}, first_vec_{years[0]}.first_vec80 as first_vec80_{years[0]}, first_vec_{years[0]}.first_vec81 as first_vec81_{years[0]}, first_vec_{years[0]}.first_vec82 as first_vec82_{years[0]}, first_vec_{years[0]}.first_vec83 as first_vec83_{years[0]}, first_vec_{years[0]}.first_vec84 as first_vec84_{years[0]}, first_vec_{years[0]}.first_vec85 as first_vec85_{years[0]}, first_vec_{years[0]}.first_vec86 as first_vec86_{years[0]}, first_vec_{years[0]}.first_vec87 as first_vec87_{years[0]}, first_vec_{years[0]}.first_vec88 as first_vec88_{years[0]}, first_vec_{years[0]}.first_vec89 as first_vec89_{years[0]}, first_vec_{years[0]}.first_vec90 as first_vec90_{years[0]}, first_vec_{years[0]}.first_vec91 as first_vec91_{years[0]}, first_vec_{years[0]}.first_vec92 as first_vec92_{years[0]}, first_vec_{years[0]}.first_vec93 as first_vec93_{years[0]}, first_vec_{years[0]}.first_vec94 as first_vec94_{years[0]}, first_vec_{years[0]}.first_vec95 as first_vec95_{years[0]}, first_vec_{years[0]}.first_vec96 as first_vec96_{years[0]}, first_vec_{years[0]}.first_vec97 as first_vec97_{years[0]}, first_vec_{years[0]}.first_vec98 as first_vec98_{years[0]}, first_vec_{years[0]}.first_vec99 as first_vec99_{years[0]}, first_vec_{years[0]}.first_vec100 as first_vec100_{years[0]}, first_vec_{years[0]}.first_vec101 as first_vec101_{years[0]}, first_vec_{years[0]}.first_vec102 as first_vec102_{years[0]}, first_vec_{years[0]}.first_vec103 as first_vec103_{years[0]}, first_vec_{years[0]}.first_vec104 as first_vec104_{years[0]}, first_vec_{years[0]}.first_vec105 as first_vec105_{years[0]}, first_vec_{years[0]}.first_vec106 as first_vec106_{years[0]}, first_vec_{years[0]}.first_vec107 as first_vec107_{years[0]}, first_vec_{years[0]}.first_vec108 as first_vec108_{years[0]}, first_vec_{years[0]}.first_vec109 as first_vec109_{years[0]}, first_vec_{years[0]}.first_vec110 as first_vec110_{years[0]}, first_vec_{years[0]}.first_vec111 as first_vec111_{years[0]}, first_vec_{years[0]}.first_vec112 as first_vec112_{years[0]}, first_vec_{years[0]}.first_vec113 as first_vec113_{years[0]}, first_vec_{years[0]}.first_vec114 as first_vec114_{years[0]}, first_vec_{years[0]}.first_vec115 as first_vec115_{years[0]}, first_vec_{years[0]}.first_vec116 as first_vec116_{years[0]}, first_vec_{years[0]}.first_vec117 as first_vec117_{years[0]}, first_vec_{years[0]}.first_vec118 as first_vec118_{years[0]}, first_vec_{years[0]}.first_vec119 as first_vec119_{years[0]}, first_vec_{years[0]}.first_vec120 as first_vec120_{years[0]}, first_vec_{years[0]}.first_vec121 as first_vec121_{years[0]}, first_vec_{years[0]}.first_vec122 as first_vec122_{years[0]}, first_vec_{years[0]}.first_vec123 as first_vec123_{years[0]}, first_vec_{years[0]}.first_vec124 as first_vec124_{years[0]}, first_vec_{years[0]}.first_vec125 as first_vec125_{years[0]}, first_vec_{years[0]}.first_vec126 as first_vec126_{years[0]}, first_vec_{years[0]}.first_vec127 as first_vec127_{years[0]}, first_vec_{years[0]}.first_vec128 as first_vec128_{years[0]}, first_vec_{years[0]}.first_vec129 as first_vec129_{years[0]}, first_vec_{years[0]}.first_vec130 as first_vec130_{years[0]}, first_vec_{years[0]}.first_vec131 as first_vec131_{years[0]}, first_vec_{years[0]}.first_vec132 as first_vec132_{years[0]}, first_vec_{years[0]}.first_vec133 as first_vec133_{years[0]}, first_vec_{years[0]}.first_vec134 as first_vec134_{years[0]}, first_vec_{years[0]}.first_vec135 as first_vec135_{years[0]}, first_vec_{years[0]}.first_vec136 as first_vec136_{years[0]}, first_vec_{years[0]}.first_vec137 as first_vec137_{years[0]}, first_vec_{years[0]}.first_vec138 as first_vec138_{years[0]}, first_vec_{years[0]}.first_vec139 as first_vec139_{years[0]}, first_vec_{years[0]}.first_vec140 as first_vec140_{years[0]}, first_vec_{years[0]}.first_vec141 as first_vec141_{years[0]}, first_vec_{years[0]}.first_vec142 as first_vec142_{years[0]}, first_vec_{years[0]}.first_vec143 as first_vec143_{years[0]}, first_vec_{years[0]}.first_vec144 as first_vec144_{years[0]}, first_vec_{years[0]}.first_vec145 as first_vec145_{years[0]}, first_vec_{years[0]}.first_vec146 as first_vec146_{years[0]}, first_vec_{years[0]}.first_vec147 as first_vec147_{years[0]}, first_vec_{years[0]}.first_vec148 as first_vec148_{years[0]}, first_vec_{years[0]}.first_vec149 as first_vec149_{years[0]}, first_vec_{years[0]}.first_vec150 as first_vec150_{years[0]}, first_vec_{years[0]}.first_vec151 as first_vec151_{years[0]}, first_vec_{years[0]}.first_vec152 as first_vec152_{years[0]}, first_vec_{years[0]}.first_vec153 as first_vec153_{years[0]}, first_vec_{years[0]}.first_vec154 as first_vec154_{years[0]}, first_vec_{years[0]}.first_vec155 as first_vec155_{years[0]}, first_vec_{years[0]}.first_vec156 as first_vec156_{years[0]}, first_vec_{years[0]}.first_vec157 as first_vec157_{years[0]}, first_vec_{years[0]}.first_vec158 as first_vec158_{years[0]}, first_vec_{years[0]}.first_vec159 as first_vec159_{years[0]}, first_vec_{years[0]}.first_vec160 as first_vec160_{years[0]}, first_vec_{years[0]}.first_vec161 as first_vec161_{years[0]}, first_vec_{years[0]}.first_vec162 as first_vec162_{years[0]}, first_vec_{years[0]}.first_vec163 as first_vec163_{years[0]}, first_vec_{years[0]}.first_vec164 as first_vec164_{years[0]}, first_vec_{years[0]}.first_vec165 as first_vec165_{years[0]}, first_vec_{years[0]}.first_vec166 as first_vec166_{years[0]}, first_vec_{years[0]}.first_vec167 as first_vec167_{years[0]}, first_vec_{years[0]}.first_vec168 as first_vec168_{years[0]}, first_vec_{years[0]}.first_vec169 as first_vec169_{years[0]}, first_vec_{years[0]}.first_vec170 as first_vec170_{years[0]}, first_vec_{years[0]}.first_vec171 as first_vec171_{years[0]}, first_vec_{years[0]}.first_vec172 as first_vec172_{years[0]}, first_vec_{years[0]}.first_vec173 as first_vec173_{years[0]}, first_vec_{years[0]}.first_vec174 as first_vec174_{years[0]}, first_vec_{years[0]}.first_vec175 as first_vec175_{years[0]}, first_vec_{years[0]}.first_vec176 as first_vec176_{years[0]}, first_vec_{years[0]}.first_vec177 as first_vec177_{years[0]}, first_vec_{years[0]}.first_vec178 as first_vec178_{years[0]}, first_vec_{years[0]}.first_vec179 as first_vec179_{years[0]}, first_vec_{years[0]}.first_vec180 as first_vec180_{years[0]}, first_vec_{years[0]}.first_vec181 as first_vec181_{years[0]}, first_vec_{years[0]}.first_vec182 as first_vec182_{years[0]}, first_vec_{years[0]}.first_vec183 as first_vec183_{years[0]}, first_vec_{years[0]}.first_vec184 as first_vec184_{years[0]}, first_vec_{years[0]}.first_vec185 as first_vec185_{years[0]}, first_vec_{years[0]}.first_vec186 as first_vec186_{years[0]}, first_vec_{years[0]}.first_vec187 as first_vec187_{years[0]}, first_vec_{years[0]}.first_vec188 as first_vec188_{years[0]}, first_vec_{years[0]}.first_vec189 as first_vec189_{years[0]}, first_vec_{years[0]}.first_vec190 as first_vec190_{years[0]}, first_vec_{years[0]}.first_vec191 as first_vec191_{years[0]}, first_vec_{years[0]}.first_vec192 as first_vec192_{years[0]}, first_vec_{years[0]}.first_vec193 as first_vec193_{years[0]}, first_vec_{years[0]}.first_vec194 as first_vec194_{years[0]}, first_vec_{years[0]}.first_vec195 as first_vec195_{years[0]}, first_vec_{years[0]}.first_vec196 as first_vec196_{years[0]}, first_vec_{years[0]}.first_vec197 as first_vec197_{years[0]}, first_vec_{years[0]}.first_vec198 as first_vec198_{years[0]}, first_vec_{years[0]}.first_vec199 as first_vec199_{years[0]}, first_vec_{years[0]}.first_vec200 as first_vec200_{years[0]}, first_vec_{years[0]}.first_vec201 as first_vec201_{years[0]}, 
	   last_vec_{years[0]}.last_vec2 as last_vec2_{years[0]}, last_vec_{years[0]}.last_vec3 as last_vec3_{years[0]}, last_vec_{years[0]}.last_vec4 as last_vec4_{years[0]}, last_vec_{years[0]}.last_vec5 as last_vec5_{years[0]}, last_vec_{years[0]}.last_vec6 as last_vec6_{years[0]}, last_vec_{years[0]}.last_vec7 as last_vec7_{years[0]}, last_vec_{years[0]}.last_vec8 as last_vec8_{years[0]}, last_vec_{years[0]}.last_vec9 as last_vec9_{years[0]}, last_vec_{years[0]}.last_vec10 as last_vec10_{years[0]}, last_vec_{years[0]}.last_vec11 as last_vec11_{years[0]}, last_vec_{years[0]}.last_vec12 as last_vec12_{years[0]}, last_vec_{years[0]}.last_vec13 as last_vec13_{years[0]}, last_vec_{years[0]}.last_vec14 as last_vec14_{years[0]}, last_vec_{years[0]}.last_vec15 as last_vec15_{years[0]}, last_vec_{years[0]}.last_vec16 as last_vec16_{years[0]}, last_vec_{years[0]}.last_vec17 as last_vec17_{years[0]}, last_vec_{years[0]}.last_vec18 as last_vec18_{years[0]}, last_vec_{years[0]}.last_vec19 as last_vec19_{years[0]}, last_vec_{years[0]}.last_vec20 as last_vec20_{years[0]}, last_vec_{years[0]}.last_vec21 as last_vec21_{years[0]}, last_vec_{years[0]}.last_vec22 as last_vec22_{years[0]}, last_vec_{years[0]}.last_vec23 as last_vec23_{years[0]}, last_vec_{years[0]}.last_vec24 as last_vec24_{years[0]}, last_vec_{years[0]}.last_vec25 as last_vec25_{years[0]}, last_vec_{years[0]}.last_vec26 as last_vec26_{years[0]}, last_vec_{years[0]}.last_vec27 as last_vec27_{years[0]}, last_vec_{years[0]}.last_vec28 as last_vec28_{years[0]}, last_vec_{years[0]}.last_vec29 as last_vec29_{years[0]}, last_vec_{years[0]}.last_vec30 as last_vec30_{years[0]}, last_vec_{years[0]}.last_vec31 as last_vec31_{years[0]}, last_vec_{years[0]}.last_vec32 as last_vec32_{years[0]}, last_vec_{years[0]}.last_vec33 as last_vec33_{years[0]}, last_vec_{years[0]}.last_vec34 as last_vec34_{years[0]}, last_vec_{years[0]}.last_vec35 as last_vec35_{years[0]}, last_vec_{years[0]}.last_vec36 as last_vec36_{years[0]}, last_vec_{years[0]}.last_vec37 as last_vec37_{years[0]}, last_vec_{years[0]}.last_vec38 as last_vec38_{years[0]}, last_vec_{years[0]}.last_vec39 as last_vec39_{years[0]}, last_vec_{years[0]}.last_vec40 as last_vec40_{years[0]}, last_vec_{years[0]}.last_vec41 as last_vec41_{years[0]}, last_vec_{years[0]}.last_vec42 as last_vec42_{years[0]}, last_vec_{years[0]}.last_vec43 as last_vec43_{years[0]}, last_vec_{years[0]}.last_vec44 as last_vec44_{years[0]}, last_vec_{years[0]}.last_vec45 as last_vec45_{years[0]}, last_vec_{years[0]}.last_vec46 as last_vec46_{years[0]}, last_vec_{years[0]}.last_vec47 as last_vec47_{years[0]}, last_vec_{years[0]}.last_vec48 as last_vec48_{years[0]}, last_vec_{years[0]}.last_vec49 as last_vec49_{years[0]}, last_vec_{years[0]}.last_vec50 as last_vec50_{years[0]}, last_vec_{years[0]}.last_vec51 as last_vec51_{years[0]}, last_vec_{years[0]}.last_vec52 as last_vec52_{years[0]}, last_vec_{years[0]}.last_vec53 as last_vec53_{years[0]}, last_vec_{years[0]}.last_vec54 as last_vec54_{years[0]}, last_vec_{years[0]}.last_vec55 as last_vec55_{years[0]}, last_vec_{years[0]}.last_vec56 as last_vec56_{years[0]}, last_vec_{years[0]}.last_vec57 as last_vec57_{years[0]}, last_vec_{years[0]}.last_vec58 as last_vec58_{years[0]}, last_vec_{years[0]}.last_vec59 as last_vec59_{years[0]}, last_vec_{years[0]}.last_vec60 as last_vec60_{years[0]}, last_vec_{years[0]}.last_vec61 as last_vec61_{years[0]}, last_vec_{years[0]}.last_vec62 as last_vec62_{years[0]}, last_vec_{years[0]}.last_vec63 as last_vec63_{years[0]}, last_vec_{years[0]}.last_vec64 as last_vec64_{years[0]}, last_vec_{years[0]}.last_vec65 as last_vec65_{years[0]}, last_vec_{years[0]}.last_vec66 as last_vec66_{years[0]}, last_vec_{years[0]}.last_vec67 as last_vec67_{years[0]}, last_vec_{years[0]}.last_vec68 as last_vec68_{years[0]}, last_vec_{years[0]}.last_vec69 as last_vec69_{years[0]}, last_vec_{years[0]}.last_vec70 as last_vec70_{years[0]}, last_vec_{years[0]}.last_vec71 as last_vec71_{years[0]}, last_vec_{years[0]}.last_vec72 as last_vec72_{years[0]}, last_vec_{years[0]}.last_vec73 as last_vec73_{years[0]}, last_vec_{years[0]}.last_vec74 as last_vec74_{years[0]}, last_vec_{years[0]}.last_vec75 as last_vec75_{years[0]}, last_vec_{years[0]}.last_vec76 as last_vec76_{years[0]}, last_vec_{years[0]}.last_vec77 as last_vec77_{years[0]}, last_vec_{years[0]}.last_vec78 as last_vec78_{years[0]}, last_vec_{years[0]}.last_vec79 as last_vec79_{years[0]}, last_vec_{years[0]}.last_vec80 as last_vec80_{years[0]}, last_vec_{years[0]}.last_vec81 as last_vec81_{years[0]}, last_vec_{years[0]}.last_vec82 as last_vec82_{years[0]}, last_vec_{years[0]}.last_vec83 as last_vec83_{years[0]}, last_vec_{years[0]}.last_vec84 as last_vec84_{years[0]}, last_vec_{years[0]}.last_vec85 as last_vec85_{years[0]}, last_vec_{years[0]}.last_vec86 as last_vec86_{years[0]}, last_vec_{years[0]}.last_vec87 as last_vec87_{years[0]}, last_vec_{years[0]}.last_vec88 as last_vec88_{years[0]}, last_vec_{years[0]}.last_vec89 as last_vec89_{years[0]}, last_vec_{years[0]}.last_vec90 as last_vec90_{years[0]}, last_vec_{years[0]}.last_vec91 as last_vec91_{years[0]}, last_vec_{years[0]}.last_vec92 as last_vec92_{years[0]}, last_vec_{years[0]}.last_vec93 as last_vec93_{years[0]}, last_vec_{years[0]}.last_vec94 as last_vec94_{years[0]}, last_vec_{years[0]}.last_vec95 as last_vec95_{years[0]}, last_vec_{years[0]}.last_vec96 as last_vec96_{years[0]}, last_vec_{years[0]}.last_vec97 as last_vec97_{years[0]}, last_vec_{years[0]}.last_vec98 as last_vec98_{years[0]}, last_vec_{years[0]}.last_vec99 as last_vec99_{years[0]}, last_vec_{years[0]}.last_vec100 as last_vec100_{years[0]}, last_vec_{years[0]}.last_vec101 as last_vec101_{years[0]}, last_vec_{years[0]}.last_vec102 as last_vec102_{years[0]}, last_vec_{years[0]}.last_vec103 as last_vec103_{years[0]}, last_vec_{years[0]}.last_vec104 as last_vec104_{years[0]}, last_vec_{years[0]}.last_vec105 as last_vec105_{years[0]}, last_vec_{years[0]}.last_vec106 as last_vec106_{years[0]}, last_vec_{years[0]}.last_vec107 as last_vec107_{years[0]}, last_vec_{years[0]}.last_vec108 as last_vec108_{years[0]}, last_vec_{years[0]}.last_vec109 as last_vec109_{years[0]}, last_vec_{years[0]}.last_vec110 as last_vec110_{years[0]}, last_vec_{years[0]}.last_vec111 as last_vec111_{years[0]}, last_vec_{years[0]}.last_vec112 as last_vec112_{years[0]}, last_vec_{years[0]}.last_vec113 as last_vec113_{years[0]}, last_vec_{years[0]}.last_vec114 as last_vec114_{years[0]}, last_vec_{years[0]}.last_vec115 as last_vec115_{years[0]}, last_vec_{years[0]}.last_vec116 as last_vec116_{years[0]}, last_vec_{years[0]}.last_vec117 as last_vec117_{years[0]}, last_vec_{years[0]}.last_vec118 as last_vec118_{years[0]}, last_vec_{years[0]}.last_vec119 as last_vec119_{years[0]}, last_vec_{years[0]}.last_vec120 as last_vec120_{years[0]}, last_vec_{years[0]}.last_vec121 as last_vec121_{years[0]}, last_vec_{years[0]}.last_vec122 as last_vec122_{years[0]}, last_vec_{years[0]}.last_vec123 as last_vec123_{years[0]}, last_vec_{years[0]}.last_vec124 as last_vec124_{years[0]}, last_vec_{years[0]}.last_vec125 as last_vec125_{years[0]}, last_vec_{years[0]}.last_vec126 as last_vec126_{years[0]}, last_vec_{years[0]}.last_vec127 as last_vec127_{years[0]}, last_vec_{years[0]}.last_vec128 as last_vec128_{years[0]}, last_vec_{years[0]}.last_vec129 as last_vec129_{years[0]}, last_vec_{years[0]}.last_vec130 as last_vec130_{years[0]}, last_vec_{years[0]}.last_vec131 as last_vec131_{years[0]}, last_vec_{years[0]}.last_vec132 as last_vec132_{years[0]}, last_vec_{years[0]}.last_vec133 as last_vec133_{years[0]}, last_vec_{years[0]}.last_vec134 as last_vec134_{years[0]}, last_vec_{years[0]}.last_vec135 as last_vec135_{years[0]}, last_vec_{years[0]}.last_vec136 as last_vec136_{years[0]}, last_vec_{years[0]}.last_vec137 as last_vec137_{years[0]}, last_vec_{years[0]}.last_vec138 as last_vec138_{years[0]}, last_vec_{years[0]}.last_vec139 as last_vec139_{years[0]}, last_vec_{years[0]}.last_vec140 as last_vec140_{years[0]}, last_vec_{years[0]}.last_vec141 as last_vec141_{years[0]}, last_vec_{years[0]}.last_vec142 as last_vec142_{years[0]}, last_vec_{years[0]}.last_vec143 as last_vec143_{years[0]}, last_vec_{years[0]}.last_vec144 as last_vec144_{years[0]}, last_vec_{years[0]}.last_vec145 as last_vec145_{years[0]}, last_vec_{years[0]}.last_vec146 as last_vec146_{years[0]}, last_vec_{years[0]}.last_vec147 as last_vec147_{years[0]}, last_vec_{years[0]}.last_vec148 as last_vec148_{years[0]}, last_vec_{years[0]}.last_vec149 as last_vec149_{years[0]}, last_vec_{years[0]}.last_vec150 as last_vec150_{years[0]}, last_vec_{years[0]}.last_vec151 as last_vec151_{years[0]}, last_vec_{years[0]}.last_vec152 as last_vec152_{years[0]}, last_vec_{years[0]}.last_vec153 as last_vec153_{years[0]}, last_vec_{years[0]}.last_vec154 as last_vec154_{years[0]}, last_vec_{years[0]}.last_vec155 as last_vec155_{years[0]}, last_vec_{years[0]}.last_vec156 as last_vec156_{years[0]}, last_vec_{years[0]}.last_vec157 as last_vec157_{years[0]}, last_vec_{years[0]}.last_vec158 as last_vec158_{years[0]}, last_vec_{years[0]}.last_vec159 as last_vec159_{years[0]}, last_vec_{years[0]}.last_vec160 as last_vec160_{years[0]}, last_vec_{years[0]}.last_vec161 as last_vec161_{years[0]}, last_vec_{years[0]}.last_vec162 as last_vec162_{years[0]}, last_vec_{years[0]}.last_vec163 as last_vec163_{years[0]}, last_vec_{years[0]}.last_vec164 as last_vec164_{years[0]}, last_vec_{years[0]}.last_vec165 as last_vec165_{years[0]}, last_vec_{years[0]}.last_vec166 as last_vec166_{years[0]}, last_vec_{years[0]}.last_vec167 as last_vec167_{years[0]}, last_vec_{years[0]}.last_vec168 as last_vec168_{years[0]}, last_vec_{years[0]}.last_vec169 as last_vec169_{years[0]}, last_vec_{years[0]}.last_vec170 as last_vec170_{years[0]}, last_vec_{years[0]}.last_vec171 as last_vec171_{years[0]}, last_vec_{years[0]}.last_vec172 as last_vec172_{years[0]}, last_vec_{years[0]}.last_vec173 as last_vec173_{years[0]}, last_vec_{years[0]}.last_vec174 as last_vec174_{years[0]}, last_vec_{years[0]}.last_vec175 as last_vec175_{years[0]}, last_vec_{years[0]}.last_vec176 as last_vec176_{years[0]}, last_vec_{years[0]}.last_vec177 as last_vec177_{years[0]}, last_vec_{years[0]}.last_vec178 as last_vec178_{years[0]}, last_vec_{years[0]}.last_vec179 as last_vec179_{years[0]}, last_vec_{years[0]}.last_vec180 as last_vec180_{years[0]}, last_vec_{years[0]}.last_vec181 as last_vec181_{years[0]}, last_vec_{years[0]}.last_vec182 as last_vec182_{years[0]}, last_vec_{years[0]}.last_vec183 as last_vec183_{years[0]}, last_vec_{years[0]}.last_vec184 as last_vec184_{years[0]}, last_vec_{years[0]}.last_vec185 as last_vec185_{years[0]}, last_vec_{years[0]}.last_vec186 as last_vec186_{years[0]}, last_vec_{years[0]}.last_vec187 as last_vec187_{years[0]}, last_vec_{years[0]}.last_vec188 as last_vec188_{years[0]}, last_vec_{years[0]}.last_vec189 as last_vec189_{years[0]}, last_vec_{years[0]}.last_vec190 as last_vec190_{years[0]}, last_vec_{years[0]}.last_vec191 as last_vec191_{years[0]}, last_vec_{years[0]}.last_vec192 as last_vec192_{years[0]}, last_vec_{years[0]}.last_vec193 as last_vec193_{years[0]}, last_vec_{years[0]}.last_vec194 as last_vec194_{years[0]}, last_vec_{years[0]}.last_vec195 as last_vec195_{years[0]}, last_vec_{years[0]}.last_vec196 as last_vec196_{years[0]}, last_vec_{years[0]}.last_vec197 as last_vec197_{years[0]}, last_vec_{years[0]}.last_vec198 as last_vec198_{years[0]}, last_vec_{years[0]}.last_vec199 as last_vec199_{years[0]}, last_vec_{years[0]}.last_vec200 as last_vec200_{years[0]}, last_vec_{years[0]}.last_vec201 as last_vec201_{years[0]},
	   census_{years[1]}.index_{years[1]}, census_{years[1]}.marstat_{years[1]}, census_{years[1]}.birth_year_{years[1]}, census_{years[1]}.household_{years[1]}, census_{years[1]}.immigration_{years[1]}, census_{years[1]}.race_{years[1]}, census_{years[1]}.rel_{years[1]},
	   census_{years[1]}.female_{years[1]}, census_{years[1]}.bp_{years[1]}, census_{years[1]}.mbp_{years[1]}, census_{years[1]}.fbp_{years[1]}, census_{years[1]}.state_{years[1]}, census_{years[1]}.county_{years[1]}, census_{years[1]}.cohort1_{years[1]},
	   census_{years[1]}.cohort2_{years[1]}, census_{years[1]}.last_sdxn_{years[1]}, census_{years[1]}.first_sdxn_{years[1]}, census_{years[1]}.last_init_{years[1]}, census_{years[1]}.first_init_{years[1]}, 
	   census_{years[1]}.bp_comm_{years[1]}, census_{years[1]}.first_comm_{years[1]}, census_{years[1]}.last_comm_{years[1]},
	   census_{years[1]}.first_{years[1]}, census_{years[1]}.last_{years[1]},
	   census_{years[1]}.bp_lat_{years[1]}, census_{years[1]}.bp_lon_{years[1]},
	   census_{years[1]}.res_lat_{years[1]}, census_{years[1]}.res_lon_{years[1]},
	   census_{years[1]}.full_name_{years[1]},
	   first_vec_{years[1]}.first_vec2 as first_vec2_{years[1]}, first_vec_{years[1]}.first_vec3 as first_vec3_{years[1]}, first_vec_{years[1]}.first_vec4 as first_vec4_{years[1]}, first_vec_{years[1]}.first_vec5 as first_vec5_{years[1]}, first_vec_{years[1]}.first_vec6 as first_vec6_{years[1]}, first_vec_{years[1]}.first_vec7 as first_vec7_{years[1]}, first_vec_{years[1]}.first_vec8 as first_vec8_{years[1]}, first_vec_{years[1]}.first_vec9 as first_vec9_{years[1]}, first_vec_{years[1]}.first_vec10 as first_vec10_{years[1]}, first_vec_{years[1]}.first_vec11 as first_vec11_{years[1]}, first_vec_{years[1]}.first_vec12 as first_vec12_{years[1]}, first_vec_{years[1]}.first_vec13 as first_vec13_{years[1]}, first_vec_{years[1]}.first_vec14 as first_vec14_{years[1]}, first_vec_{years[1]}.first_vec15 as first_vec15_{years[1]}, first_vec_{years[1]}.first_vec16 as first_vec16_{years[1]}, first_vec_{years[1]}.first_vec17 as first_vec17_{years[1]}, first_vec_{years[1]}.first_vec18 as first_vec18_{years[1]}, first_vec_{years[1]}.first_vec19 as first_vec19_{years[1]}, first_vec_{years[1]}.first_vec20 as first_vec20_{years[1]}, first_vec_{years[1]}.first_vec21 as first_vec21_{years[1]}, first_vec_{years[1]}.first_vec22 as first_vec22_{years[1]}, first_vec_{years[1]}.first_vec23 as first_vec23_{years[1]}, first_vec_{years[1]}.first_vec24 as first_vec24_{years[1]}, first_vec_{years[1]}.first_vec25 as first_vec25_{years[1]}, first_vec_{years[1]}.first_vec26 as first_vec26_{years[1]}, first_vec_{years[1]}.first_vec27 as first_vec27_{years[1]}, first_vec_{years[1]}.first_vec28 as first_vec28_{years[1]}, first_vec_{years[1]}.first_vec29 as first_vec29_{years[1]}, first_vec_{years[1]}.first_vec30 as first_vec30_{years[1]}, first_vec_{years[1]}.first_vec31 as first_vec31_{years[1]}, first_vec_{years[1]}.first_vec32 as first_vec32_{years[1]}, first_vec_{years[1]}.first_vec33 as first_vec33_{years[1]}, first_vec_{years[1]}.first_vec34 as first_vec34_{years[1]}, first_vec_{years[1]}.first_vec35 as first_vec35_{years[1]}, first_vec_{years[1]}.first_vec36 as first_vec36_{years[1]}, first_vec_{years[1]}.first_vec37 as first_vec37_{years[1]}, first_vec_{years[1]}.first_vec38 as first_vec38_{years[1]}, first_vec_{years[1]}.first_vec39 as first_vec39_{years[1]}, first_vec_{years[1]}.first_vec40 as first_vec40_{years[1]}, first_vec_{years[1]}.first_vec41 as first_vec41_{years[1]}, first_vec_{years[1]}.first_vec42 as first_vec42_{years[1]}, first_vec_{years[1]}.first_vec43 as first_vec43_{years[1]}, first_vec_{years[1]}.first_vec44 as first_vec44_{years[1]}, first_vec_{years[1]}.first_vec45 as first_vec45_{years[1]}, first_vec_{years[1]}.first_vec46 as first_vec46_{years[1]}, first_vec_{years[1]}.first_vec47 as first_vec47_{years[1]}, first_vec_{years[1]}.first_vec48 as first_vec48_{years[1]}, first_vec_{years[1]}.first_vec49 as first_vec49_{years[1]}, first_vec_{years[1]}.first_vec50 as first_vec50_{years[1]}, first_vec_{years[1]}.first_vec51 as first_vec51_{years[1]}, first_vec_{years[1]}.first_vec52 as first_vec52_{years[1]}, first_vec_{years[1]}.first_vec53 as first_vec53_{years[1]}, first_vec_{years[1]}.first_vec54 as first_vec54_{years[1]}, first_vec_{years[1]}.first_vec55 as first_vec55_{years[1]}, first_vec_{years[1]}.first_vec56 as first_vec56_{years[1]}, first_vec_{years[1]}.first_vec57 as first_vec57_{years[1]}, first_vec_{years[1]}.first_vec58 as first_vec58_{years[1]}, first_vec_{years[1]}.first_vec59 as first_vec59_{years[1]}, first_vec_{years[1]}.first_vec60 as first_vec60_{years[1]}, first_vec_{years[1]}.first_vec61 as first_vec61_{years[1]}, first_vec_{years[1]}.first_vec62 as first_vec62_{years[1]}, first_vec_{years[1]}.first_vec63 as first_vec63_{years[1]}, first_vec_{years[1]}.first_vec64 as first_vec64_{years[1]}, first_vec_{years[1]}.first_vec65 as first_vec65_{years[1]}, first_vec_{years[1]}.first_vec66 as first_vec66_{years[1]}, first_vec_{years[1]}.first_vec67 as first_vec67_{years[1]}, first_vec_{years[1]}.first_vec68 as first_vec68_{years[1]}, first_vec_{years[1]}.first_vec69 as first_vec69_{years[1]}, first_vec_{years[1]}.first_vec70 as first_vec70_{years[1]}, first_vec_{years[1]}.first_vec71 as first_vec71_{years[1]}, first_vec_{years[1]}.first_vec72 as first_vec72_{years[1]}, first_vec_{years[1]}.first_vec73 as first_vec73_{years[1]}, first_vec_{years[1]}.first_vec74 as first_vec74_{years[1]}, first_vec_{years[1]}.first_vec75 as first_vec75_{years[1]}, first_vec_{years[1]}.first_vec76 as first_vec76_{years[1]}, first_vec_{years[1]}.first_vec77 as first_vec77_{years[1]}, first_vec_{years[1]}.first_vec78 as first_vec78_{years[1]}, first_vec_{years[1]}.first_vec79 as first_vec79_{years[1]}, first_vec_{years[1]}.first_vec80 as first_vec80_{years[1]}, first_vec_{years[1]}.first_vec81 as first_vec81_{years[1]}, first_vec_{years[1]}.first_vec82 as first_vec82_{years[1]}, first_vec_{years[1]}.first_vec83 as first_vec83_{years[1]}, first_vec_{years[1]}.first_vec84 as first_vec84_{years[1]}, first_vec_{years[1]}.first_vec85 as first_vec85_{years[1]}, first_vec_{years[1]}.first_vec86 as first_vec86_{years[1]}, first_vec_{years[1]}.first_vec87 as first_vec87_{years[1]}, first_vec_{years[1]}.first_vec88 as first_vec88_{years[1]}, first_vec_{years[1]}.first_vec89 as first_vec89_{years[1]}, first_vec_{years[1]}.first_vec90 as first_vec90_{years[1]}, first_vec_{years[1]}.first_vec91 as first_vec91_{years[1]}, first_vec_{years[1]}.first_vec92 as first_vec92_{years[1]}, first_vec_{years[1]}.first_vec93 as first_vec93_{years[1]}, first_vec_{years[1]}.first_vec94 as first_vec94_{years[1]}, first_vec_{years[1]}.first_vec95 as first_vec95_{years[1]}, first_vec_{years[1]}.first_vec96 as first_vec96_{years[1]}, first_vec_{years[1]}.first_vec97 as first_vec97_{years[1]}, first_vec_{years[1]}.first_vec98 as first_vec98_{years[1]}, first_vec_{years[1]}.first_vec99 as first_vec99_{years[1]}, first_vec_{years[1]}.first_vec100 as first_vec100_{years[1]}, first_vec_{years[1]}.first_vec101 as first_vec101_{years[1]}, first_vec_{years[1]}.first_vec102 as first_vec102_{years[1]}, first_vec_{years[1]}.first_vec103 as first_vec103_{years[1]}, first_vec_{years[1]}.first_vec104 as first_vec104_{years[1]}, first_vec_{years[1]}.first_vec105 as first_vec105_{years[1]}, first_vec_{years[1]}.first_vec106 as first_vec106_{years[1]}, first_vec_{years[1]}.first_vec107 as first_vec107_{years[1]}, first_vec_{years[1]}.first_vec108 as first_vec108_{years[1]}, first_vec_{years[1]}.first_vec109 as first_vec109_{years[1]}, first_vec_{years[1]}.first_vec110 as first_vec110_{years[1]}, first_vec_{years[1]}.first_vec111 as first_vec111_{years[1]}, first_vec_{years[1]}.first_vec112 as first_vec112_{years[1]}, first_vec_{years[1]}.first_vec113 as first_vec113_{years[1]}, first_vec_{years[1]}.first_vec114 as first_vec114_{years[1]}, first_vec_{years[1]}.first_vec115 as first_vec115_{years[1]}, first_vec_{years[1]}.first_vec116 as first_vec116_{years[1]}, first_vec_{years[1]}.first_vec117 as first_vec117_{years[1]}, first_vec_{years[1]}.first_vec118 as first_vec118_{years[1]}, first_vec_{years[1]}.first_vec119 as first_vec119_{years[1]}, first_vec_{years[1]}.first_vec120 as first_vec120_{years[1]}, first_vec_{years[1]}.first_vec121 as first_vec121_{years[1]}, first_vec_{years[1]}.first_vec122 as first_vec122_{years[1]}, first_vec_{years[1]}.first_vec123 as first_vec123_{years[1]}, first_vec_{years[1]}.first_vec124 as first_vec124_{years[1]}, first_vec_{years[1]}.first_vec125 as first_vec125_{years[1]}, first_vec_{years[1]}.first_vec126 as first_vec126_{years[1]}, first_vec_{years[1]}.first_vec127 as first_vec127_{years[1]}, first_vec_{years[1]}.first_vec128 as first_vec128_{years[1]}, first_vec_{years[1]}.first_vec129 as first_vec129_{years[1]}, first_vec_{years[1]}.first_vec130 as first_vec130_{years[1]}, first_vec_{years[1]}.first_vec131 as first_vec131_{years[1]}, first_vec_{years[1]}.first_vec132 as first_vec132_{years[1]}, first_vec_{years[1]}.first_vec133 as first_vec133_{years[1]}, first_vec_{years[1]}.first_vec134 as first_vec134_{years[1]}, first_vec_{years[1]}.first_vec135 as first_vec135_{years[1]}, first_vec_{years[1]}.first_vec136 as first_vec136_{years[1]}, first_vec_{years[1]}.first_vec137 as first_vec137_{years[1]}, first_vec_{years[1]}.first_vec138 as first_vec138_{years[1]}, first_vec_{years[1]}.first_vec139 as first_vec139_{years[1]}, first_vec_{years[1]}.first_vec140 as first_vec140_{years[1]}, first_vec_{years[1]}.first_vec141 as first_vec141_{years[1]}, first_vec_{years[1]}.first_vec142 as first_vec142_{years[1]}, first_vec_{years[1]}.first_vec143 as first_vec143_{years[1]}, first_vec_{years[1]}.first_vec144 as first_vec144_{years[1]}, first_vec_{years[1]}.first_vec145 as first_vec145_{years[1]}, first_vec_{years[1]}.first_vec146 as first_vec146_{years[1]}, first_vec_{years[1]}.first_vec147 as first_vec147_{years[1]}, first_vec_{years[1]}.first_vec148 as first_vec148_{years[1]}, first_vec_{years[1]}.first_vec149 as first_vec149_{years[1]}, first_vec_{years[1]}.first_vec150 as first_vec150_{years[1]}, first_vec_{years[1]}.first_vec151 as first_vec151_{years[1]}, first_vec_{years[1]}.first_vec152 as first_vec152_{years[1]}, first_vec_{years[1]}.first_vec153 as first_vec153_{years[1]}, first_vec_{years[1]}.first_vec154 as first_vec154_{years[1]}, first_vec_{years[1]}.first_vec155 as first_vec155_{years[1]}, first_vec_{years[1]}.first_vec156 as first_vec156_{years[1]}, first_vec_{years[1]}.first_vec157 as first_vec157_{years[1]}, first_vec_{years[1]}.first_vec158 as first_vec158_{years[1]}, first_vec_{years[1]}.first_vec159 as first_vec159_{years[1]}, first_vec_{years[1]}.first_vec160 as first_vec160_{years[1]}, first_vec_{years[1]}.first_vec161 as first_vec161_{years[1]}, first_vec_{years[1]}.first_vec162 as first_vec162_{years[1]}, first_vec_{years[1]}.first_vec163 as first_vec163_{years[1]}, first_vec_{years[1]}.first_vec164 as first_vec164_{years[1]}, first_vec_{years[1]}.first_vec165 as first_vec165_{years[1]}, first_vec_{years[1]}.first_vec166 as first_vec166_{years[1]}, first_vec_{years[1]}.first_vec167 as first_vec167_{years[1]}, first_vec_{years[1]}.first_vec168 as first_vec168_{years[1]}, first_vec_{years[1]}.first_vec169 as first_vec169_{years[1]}, first_vec_{years[1]}.first_vec170 as first_vec170_{years[1]}, first_vec_{years[1]}.first_vec171 as first_vec171_{years[1]}, first_vec_{years[1]}.first_vec172 as first_vec172_{years[1]}, first_vec_{years[1]}.first_vec173 as first_vec173_{years[1]}, first_vec_{years[1]}.first_vec174 as first_vec174_{years[1]}, first_vec_{years[1]}.first_vec175 as first_vec175_{years[1]}, first_vec_{years[1]}.first_vec176 as first_vec176_{years[1]}, first_vec_{years[1]}.first_vec177 as first_vec177_{years[1]}, first_vec_{years[1]}.first_vec178 as first_vec178_{years[1]}, first_vec_{years[1]}.first_vec179 as first_vec179_{years[1]}, first_vec_{years[1]}.first_vec180 as first_vec180_{years[1]}, first_vec_{years[1]}.first_vec181 as first_vec181_{years[1]}, first_vec_{years[1]}.first_vec182 as first_vec182_{years[1]}, first_vec_{years[1]}.first_vec183 as first_vec183_{years[1]}, first_vec_{years[1]}.first_vec184 as first_vec184_{years[1]}, first_vec_{years[1]}.first_vec185 as first_vec185_{years[1]}, first_vec_{years[1]}.first_vec186 as first_vec186_{years[1]}, first_vec_{years[1]}.first_vec187 as first_vec187_{years[1]}, first_vec_{years[1]}.first_vec188 as first_vec188_{years[1]}, first_vec_{years[1]}.first_vec189 as first_vec189_{years[1]}, first_vec_{years[1]}.first_vec190 as first_vec190_{years[1]}, first_vec_{years[1]}.first_vec191 as first_vec191_{years[1]}, first_vec_{years[1]}.first_vec192 as first_vec192_{years[1]}, first_vec_{years[1]}.first_vec193 as first_vec193_{years[1]}, first_vec_{years[1]}.first_vec194 as first_vec194_{years[1]}, first_vec_{years[1]}.first_vec195 as first_vec195_{years[1]}, first_vec_{years[1]}.first_vec196 as first_vec196_{years[1]}, first_vec_{years[1]}.first_vec197 as first_vec197_{years[1]}, first_vec_{years[1]}.first_vec198 as first_vec198_{years[1]}, first_vec_{years[1]}.first_vec199 as first_vec199_{years[1]}, first_vec_{years[1]}.first_vec200 as first_vec200_{years[1]}, first_vec_{years[1]}.first_vec201 as first_vec201_{years[1]}, 
	   last_vec_{years[1]}.last_vec2 as last_vec2_{years[1]}, last_vec_{years[1]}.last_vec3 as last_vec3_{years[1]}, last_vec_{years[1]}.last_vec4 as last_vec4_{years[1]}, last_vec_{years[1]}.last_vec5 as last_vec5_{years[1]}, last_vec_{years[1]}.last_vec6 as last_vec6_{years[1]}, last_vec_{years[1]}.last_vec7 as last_vec7_{years[1]}, last_vec_{years[1]}.last_vec8 as last_vec8_{years[1]}, last_vec_{years[1]}.last_vec9 as last_vec9_{years[1]}, last_vec_{years[1]}.last_vec10 as last_vec10_{years[1]}, last_vec_{years[1]}.last_vec11 as last_vec11_{years[1]}, last_vec_{years[1]}.last_vec12 as last_vec12_{years[1]}, last_vec_{years[1]}.last_vec13 as last_vec13_{years[1]}, last_vec_{years[1]}.last_vec14 as last_vec14_{years[1]}, last_vec_{years[1]}.last_vec15 as last_vec15_{years[1]}, last_vec_{years[1]}.last_vec16 as last_vec16_{years[1]}, last_vec_{years[1]}.last_vec17 as last_vec17_{years[1]}, last_vec_{years[1]}.last_vec18 as last_vec18_{years[1]}, last_vec_{years[1]}.last_vec19 as last_vec19_{years[1]}, last_vec_{years[1]}.last_vec20 as last_vec20_{years[1]}, last_vec_{years[1]}.last_vec21 as last_vec21_{years[1]}, last_vec_{years[1]}.last_vec22 as last_vec22_{years[1]}, last_vec_{years[1]}.last_vec23 as last_vec23_{years[1]}, last_vec_{years[1]}.last_vec24 as last_vec24_{years[1]}, last_vec_{years[1]}.last_vec25 as last_vec25_{years[1]}, last_vec_{years[1]}.last_vec26 as last_vec26_{years[1]}, last_vec_{years[1]}.last_vec27 as last_vec27_{years[1]}, last_vec_{years[1]}.last_vec28 as last_vec28_{years[1]}, last_vec_{years[1]}.last_vec29 as last_vec29_{years[1]}, last_vec_{years[1]}.last_vec30 as last_vec30_{years[1]}, last_vec_{years[1]}.last_vec31 as last_vec31_{years[1]}, last_vec_{years[1]}.last_vec32 as last_vec32_{years[1]}, last_vec_{years[1]}.last_vec33 as last_vec33_{years[1]}, last_vec_{years[1]}.last_vec34 as last_vec34_{years[1]}, last_vec_{years[1]}.last_vec35 as last_vec35_{years[1]}, last_vec_{years[1]}.last_vec36 as last_vec36_{years[1]}, last_vec_{years[1]}.last_vec37 as last_vec37_{years[1]}, last_vec_{years[1]}.last_vec38 as last_vec38_{years[1]}, last_vec_{years[1]}.last_vec39 as last_vec39_{years[1]}, last_vec_{years[1]}.last_vec40 as last_vec40_{years[1]}, last_vec_{years[1]}.last_vec41 as last_vec41_{years[1]}, last_vec_{years[1]}.last_vec42 as last_vec42_{years[1]}, last_vec_{years[1]}.last_vec43 as last_vec43_{years[1]}, last_vec_{years[1]}.last_vec44 as last_vec44_{years[1]}, last_vec_{years[1]}.last_vec45 as last_vec45_{years[1]}, last_vec_{years[1]}.last_vec46 as last_vec46_{years[1]}, last_vec_{years[1]}.last_vec47 as last_vec47_{years[1]}, last_vec_{years[1]}.last_vec48 as last_vec48_{years[1]}, last_vec_{years[1]}.last_vec49 as last_vec49_{years[1]}, last_vec_{years[1]}.last_vec50 as last_vec50_{years[1]}, last_vec_{years[1]}.last_vec51 as last_vec51_{years[1]}, last_vec_{years[1]}.last_vec52 as last_vec52_{years[1]}, last_vec_{years[1]}.last_vec53 as last_vec53_{years[1]}, last_vec_{years[1]}.last_vec54 as last_vec54_{years[1]}, last_vec_{years[1]}.last_vec55 as last_vec55_{years[1]}, last_vec_{years[1]}.last_vec56 as last_vec56_{years[1]}, last_vec_{years[1]}.last_vec57 as last_vec57_{years[1]}, last_vec_{years[1]}.last_vec58 as last_vec58_{years[1]}, last_vec_{years[1]}.last_vec59 as last_vec59_{years[1]}, last_vec_{years[1]}.last_vec60 as last_vec60_{years[1]}, last_vec_{years[1]}.last_vec61 as last_vec61_{years[1]}, last_vec_{years[1]}.last_vec62 as last_vec62_{years[1]}, last_vec_{years[1]}.last_vec63 as last_vec63_{years[1]}, last_vec_{years[1]}.last_vec64 as last_vec64_{years[1]}, last_vec_{years[1]}.last_vec65 as last_vec65_{years[1]}, last_vec_{years[1]}.last_vec66 as last_vec66_{years[1]}, last_vec_{years[1]}.last_vec67 as last_vec67_{years[1]}, last_vec_{years[1]}.last_vec68 as last_vec68_{years[1]}, last_vec_{years[1]}.last_vec69 as last_vec69_{years[1]}, last_vec_{years[1]}.last_vec70 as last_vec70_{years[1]}, last_vec_{years[1]}.last_vec71 as last_vec71_{years[1]}, last_vec_{years[1]}.last_vec72 as last_vec72_{years[1]}, last_vec_{years[1]}.last_vec73 as last_vec73_{years[1]}, last_vec_{years[1]}.last_vec74 as last_vec74_{years[1]}, last_vec_{years[1]}.last_vec75 as last_vec75_{years[1]}, last_vec_{years[1]}.last_vec76 as last_vec76_{years[1]}, last_vec_{years[1]}.last_vec77 as last_vec77_{years[1]}, last_vec_{years[1]}.last_vec78 as last_vec78_{years[1]}, last_vec_{years[1]}.last_vec79 as last_vec79_{years[1]}, last_vec_{years[1]}.last_vec80 as last_vec80_{years[1]}, last_vec_{years[1]}.last_vec81 as last_vec81_{years[1]}, last_vec_{years[1]}.last_vec82 as last_vec82_{years[1]}, last_vec_{years[1]}.last_vec83 as last_vec83_{years[1]}, last_vec_{years[1]}.last_vec84 as last_vec84_{years[1]}, last_vec_{years[1]}.last_vec85 as last_vec85_{years[1]}, last_vec_{years[1]}.last_vec86 as last_vec86_{years[1]}, last_vec_{years[1]}.last_vec87 as last_vec87_{years[1]}, last_vec_{years[1]}.last_vec88 as last_vec88_{years[1]}, last_vec_{years[1]}.last_vec89 as last_vec89_{years[1]}, last_vec_{years[1]}.last_vec90 as last_vec90_{years[1]}, last_vec_{years[1]}.last_vec91 as last_vec91_{years[1]}, last_vec_{years[1]}.last_vec92 as last_vec92_{years[1]}, last_vec_{years[1]}.last_vec93 as last_vec93_{years[1]}, last_vec_{years[1]}.last_vec94 as last_vec94_{years[1]}, last_vec_{years[1]}.last_vec95 as last_vec95_{years[1]}, last_vec_{years[1]}.last_vec96 as last_vec96_{years[1]}, last_vec_{years[1]}.last_vec97 as last_vec97_{years[1]}, last_vec_{years[1]}.last_vec98 as last_vec98_{years[1]}, last_vec_{years[1]}.last_vec99 as last_vec99_{years[1]}, last_vec_{years[1]}.last_vec100 as last_vec100_{years[1]}, last_vec_{years[1]}.last_vec101 as last_vec101_{years[1]}, last_vec_{years[1]}.last_vec102 as last_vec102_{years[1]}, last_vec_{years[1]}.last_vec103 as last_vec103_{years[1]}, last_vec_{years[1]}.last_vec104 as last_vec104_{years[1]}, last_vec_{years[1]}.last_vec105 as last_vec105_{years[1]}, last_vec_{years[1]}.last_vec106 as last_vec106_{years[1]}, last_vec_{years[1]}.last_vec107 as last_vec107_{years[1]}, last_vec_{years[1]}.last_vec108 as last_vec108_{years[1]}, last_vec_{years[1]}.last_vec109 as last_vec109_{years[1]}, last_vec_{years[1]}.last_vec110 as last_vec110_{years[1]}, last_vec_{years[1]}.last_vec111 as last_vec111_{years[1]}, last_vec_{years[1]}.last_vec112 as last_vec112_{years[1]}, last_vec_{years[1]}.last_vec113 as last_vec113_{years[1]}, last_vec_{years[1]}.last_vec114 as last_vec114_{years[1]}, last_vec_{years[1]}.last_vec115 as last_vec115_{years[1]}, last_vec_{years[1]}.last_vec116 as last_vec116_{years[1]}, last_vec_{years[1]}.last_vec117 as last_vec117_{years[1]}, last_vec_{years[1]}.last_vec118 as last_vec118_{years[1]}, last_vec_{years[1]}.last_vec119 as last_vec119_{years[1]}, last_vec_{years[1]}.last_vec120 as last_vec120_{years[1]}, last_vec_{years[1]}.last_vec121 as last_vec121_{years[1]}, last_vec_{years[1]}.last_vec122 as last_vec122_{years[1]}, last_vec_{years[1]}.last_vec123 as last_vec123_{years[1]}, last_vec_{years[1]}.last_vec124 as last_vec124_{years[1]}, last_vec_{years[1]}.last_vec125 as last_vec125_{years[1]}, last_vec_{years[1]}.last_vec126 as last_vec126_{years[1]}, last_vec_{years[1]}.last_vec127 as last_vec127_{years[1]}, last_vec_{years[1]}.last_vec128 as last_vec128_{years[1]}, last_vec_{years[1]}.last_vec129 as last_vec129_{years[1]}, last_vec_{years[1]}.last_vec130 as last_vec130_{years[1]}, last_vec_{years[1]}.last_vec131 as last_vec131_{years[1]}, last_vec_{years[1]}.last_vec132 as last_vec132_{years[1]}, last_vec_{years[1]}.last_vec133 as last_vec133_{years[1]}, last_vec_{years[1]}.last_vec134 as last_vec134_{years[1]}, last_vec_{years[1]}.last_vec135 as last_vec135_{years[1]}, last_vec_{years[1]}.last_vec136 as last_vec136_{years[1]}, last_vec_{years[1]}.last_vec137 as last_vec137_{years[1]}, last_vec_{years[1]}.last_vec138 as last_vec138_{years[1]}, last_vec_{years[1]}.last_vec139 as last_vec139_{years[1]}, last_vec_{years[1]}.last_vec140 as last_vec140_{years[1]}, last_vec_{years[1]}.last_vec141 as last_vec141_{years[1]}, last_vec_{years[1]}.last_vec142 as last_vec142_{years[1]}, last_vec_{years[1]}.last_vec143 as last_vec143_{years[1]}, last_vec_{years[1]}.last_vec144 as last_vec144_{years[1]}, last_vec_{years[1]}.last_vec145 as last_vec145_{years[1]}, last_vec_{years[1]}.last_vec146 as last_vec146_{years[1]}, last_vec_{years[1]}.last_vec147 as last_vec147_{years[1]}, last_vec_{years[1]}.last_vec148 as last_vec148_{years[1]}, last_vec_{years[1]}.last_vec149 as last_vec149_{years[1]}, last_vec_{years[1]}.last_vec150 as last_vec150_{years[1]}, last_vec_{years[1]}.last_vec151 as last_vec151_{years[1]}, last_vec_{years[1]}.last_vec152 as last_vec152_{years[1]}, last_vec_{years[1]}.last_vec153 as last_vec153_{years[1]}, last_vec_{years[1]}.last_vec154 as last_vec154_{years[1]}, last_vec_{years[1]}.last_vec155 as last_vec155_{years[1]}, last_vec_{years[1]}.last_vec156 as last_vec156_{years[1]}, last_vec_{years[1]}.last_vec157 as last_vec157_{years[1]}, last_vec_{years[1]}.last_vec158 as last_vec158_{years[1]}, last_vec_{years[1]}.last_vec159 as last_vec159_{years[1]}, last_vec_{years[1]}.last_vec160 as last_vec160_{years[1]}, last_vec_{years[1]}.last_vec161 as last_vec161_{years[1]}, last_vec_{years[1]}.last_vec162 as last_vec162_{years[1]}, last_vec_{years[1]}.last_vec163 as last_vec163_{years[1]}, last_vec_{years[1]}.last_vec164 as last_vec164_{years[1]}, last_vec_{years[1]}.last_vec165 as last_vec165_{years[1]}, last_vec_{years[1]}.last_vec166 as last_vec166_{years[1]}, last_vec_{years[1]}.last_vec167 as last_vec167_{years[1]}, last_vec_{years[1]}.last_vec168 as last_vec168_{years[1]}, last_vec_{years[1]}.last_vec169 as last_vec169_{years[1]}, last_vec_{years[1]}.last_vec170 as last_vec170_{years[1]}, last_vec_{years[1]}.last_vec171 as last_vec171_{years[1]}, last_vec_{years[1]}.last_vec172 as last_vec172_{years[1]}, last_vec_{years[1]}.last_vec173 as last_vec173_{years[1]}, last_vec_{years[1]}.last_vec174 as last_vec174_{years[1]}, last_vec_{years[1]}.last_vec175 as last_vec175_{years[1]}, last_vec_{years[1]}.last_vec176 as last_vec176_{years[1]}, last_vec_{years[1]}.last_vec177 as last_vec177_{years[1]}, last_vec_{years[1]}.last_vec178 as last_vec178_{years[1]}, last_vec_{years[1]}.last_vec179 as last_vec179_{years[1]}, last_vec_{years[1]}.last_vec180 as last_vec180_{years[1]}, last_vec_{years[1]}.last_vec181 as last_vec181_{years[1]}, last_vec_{years[1]}.last_vec182 as last_vec182_{years[1]}, last_vec_{years[1]}.last_vec183 as last_vec183_{years[1]}, last_vec_{years[1]}.last_vec184 as last_vec184_{years[1]}, last_vec_{years[1]}.last_vec185 as last_vec185_{years[1]}, last_vec_{years[1]}.last_vec186 as last_vec186_{years[1]}, last_vec_{years[1]}.last_vec187 as last_vec187_{years[1]}, last_vec_{years[1]}.last_vec188 as last_vec188_{years[1]}, last_vec_{years[1]}.last_vec189 as last_vec189_{years[1]}, last_vec_{years[1]}.last_vec190 as last_vec190_{years[1]}, last_vec_{years[1]}.last_vec191 as last_vec191_{years[1]}, last_vec_{years[1]}.last_vec192 as last_vec192_{years[1]}, last_vec_{years[1]}.last_vec193 as last_vec193_{years[1]}, last_vec_{years[1]}.last_vec194 as last_vec194_{years[1]}, last_vec_{years[1]}.last_vec195 as last_vec195_{years[1]}, last_vec_{years[1]}.last_vec196 as last_vec196_{years[1]}, last_vec_{years[1]}.last_vec197 as last_vec197_{years[1]}, last_vec_{years[1]}.last_vec198 as last_vec198_{years[1]}, last_vec_{years[1]}.last_vec199 as last_vec199_{years[1]}, last_vec_{years[1]}.last_vec200 as last_vec200_{years[1]}, last_vec_{years[1]}.last_vec201 as last_vec201_{years[1]}

from Price.dbo.training_indices_{years[0]}_{years[1]}_{batch_num} as ind
left join Price.dbo.compiled_{years[0]} as census_{years[0]} on ind.index_{years[0]} = census_{years[0]}.index_{years[0]}
left join Price.dbo.crosswalk_first_vec as first_vec_{years[0]} on census_{years[0]}.first_{years[0]} = first_vec_{years[0]}.pr_name_gn
left join Price.dbo.crosswalk_last_vec  as last_vec_{years[0]}  on census_{years[0]}.last_{years[0]}  = last_vec_{years[0]}.pr_name_surn

left join Price.dbo.compiled_{years[1]} as census_{years[1]} on ind.index_{years[1]} = census_{years[1]}.index_{years[1]}
left join Price.dbo.crosswalk_first_vec as first_vec_{years[1]} on census_{years[1]}.first_{years[1]} = first_vec_{years[1]}.pr_name_gn
left join Price.dbo.crosswalk_last_vec as last_vec_{years[1]} on census_{years[1]}.last_{years[1]} = last_vec_{years[1]}.pr_name_surn
where ind.index_{years[0]} >= {index1} and ind.index_{years[0]} < {index2}"""
            for chunk in pd.read_sql(sql_code, conn, chunksize = 100000):
                print(f"Processing chunk number {chunk_num}")
                chunk_num += 1
                record_linker.candidate_pairs = chunk
                #record_linker.candidate_pairs = record_linker.candidate_pairs.drop(["true_index_1920"], axis = 1)
                record_linker.candidate_pairs.loc[~record_linker.candidate_pairs[f"full_name_{years[0]}"].isnull(), f"first_{years[0]}"] = record_linker.candidate_pairs.loc[~record_linker.candidate_pairs[f"full_name_{years[0]}"].isnull(), f"full_name_{years[0]}"]
                record_linker.candidate_pairs.loc[~record_linker.candidate_pairs[f"full_name_{years[1]}"].isnull(), f"first_{years[1]}"] = record_linker.candidate_pairs.loc[~record_linker.candidate_pairs[f"full_name_{years[1]}"].isnull(), f"full_name_{years[1]}"]
                record_linker.create_features()
                record_linker.candidate_pairs = record_linker.candidate_pairs.drop([f"{i}_{years[0]}" for i in cols_to_drop], axis=1).drop([f"{i}_{years[1]}" for i in cols_to_drop], axis=1) #FIXME remove this for later batches
                record_linker.arks = record_linker.candidate_pairs.loc[:, [f"index_{years[0]}", f"index_{years[1]}"]]
                record_linker.candidate_pairs = record_linker.candidate_pairs.drop([f"index_{years[0]}", f"index_{years[1]}"], axis=1) #Add true_index_1920 back in if training and also generate true matches by comparing 1920 indices
                preds = pd.DataFrame(model.predict(record_linker.candidate_pairs), columns=["is_match"])
                preds = pd.concat([record_linker.arks, preds], axis=1)
                preds = preds.loc[preds.is_match, [f"index_{years[0]}", f"index_{years[1]}"]]
                preds.to_csv(f"R:/JoePriceResearch/record_linking/data/preds3/preds_{years[0]}_{years[1]}_pt{batch_num}.csv", index=None, mode='a')
            index1 += 100000
            index2 += 100000
        end = time()
        print(f"time taken: {end - start} seconds")
        return end - start
    except Exception:
        print(traceback.format_exc())
        try:
            return record_linker
        except:
            return None